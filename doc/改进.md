![img](sbyt.png "vis")

训练脚本和ufldv2的一模一样

# 1 本代码做了下面几点的修改：

1 判别车道线类别：白实线，白虚线，黄实线，黄虚线。这里为了和作者里面车道线分类分开，取名车道线判别。

2 优化原始模型的网络，减低参数量，加快检测速度。

3 使用val_gt.txt作为验证部分。

# 2 修改思路

下面分析以culane数据加载为例。

通过分析ufld-v2网络结构为：backbone(resnet18-nocls)+pool(conv)+cls(layernorm+fc+relu+fc)。通过分析发现大量参数集中在后面的两个fc上面。

分析loss计算参数，模型预测结果之间没有相互的优化关系。

关于添加分类相内容，我这里做了3种尝试：

1 对判断车道线是否存在做修改

2 对车道线分类做修改

3 添加一个判别车道线的头

经过测试，发现第3种方法最好。前两种算法不仅要计算row方向的，还要计算col方向的。

# 3 数据标注

我用的culane数据做的测试。

首先，需要把culane的数据改成labelme的格式，修改标出来的4条车道线的lable。白实线，白虚线，黄实线，黄虚线。

然后在转回到culane数据的格式。

根据原始train_gt.txt以及culane的生成json文件，生成新的train_gt.txt。比如原始的为

```
/driver_23_30frame/05151649_0422.MP4/00000.jpg /laneseg_label_w16/driver_23_30frame/05151649_0422.MP4/00000.png 1 1 0 1
```

生成新得为：

```
/driver_23_30frame/05151649_0422.MP4/00000.jpg /laneseg_label_w16/driver_23_30frame/05151649_0422.MP4/00000.png 1 3 0 2
```

# 4 关于训练

保持和作者的提供的方法一致。

# Tips

如果你发现保存的模型特别特别大，1.6G了。原因是作者吧求梯度过程的参数保存了进去了。
